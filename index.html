<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.10">
<title>XS2A Adapter</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<style>
/* Asciidoctor default stylesheet | MIT License | https://asciidoctor.org */
/* Uncomment @import statement to use as custom stylesheet */
/*@import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700";*/
article,aside,details,figcaption,figure,footer,header,hgroup,main,nav,section{display:block}
audio,video{display:inline-block}
audio:not([controls]){display:none;height:0}
html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}
a{background:none}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
abbr[title]{border-bottom:1px dotted}
b,strong{font-weight:bold}
dfn{font-style:italic}
hr{-moz-box-sizing:content-box;box-sizing:content-box;height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type="button"],input[type="reset"],input[type="submit"]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type="checkbox"],input[type="radio"]{box-sizing:border-box;padding:0}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,*::before,*::after{-moz-box-sizing:border-box;-webkit-box-sizing:border-box;box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;font-weight:400;font-style:normal;line-height:1;position:relative;cursor:auto;tab-size:4;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.center{margin-left:auto;margin-right:auto}
.stretch{width:100%}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0;direction:ltr}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:0}
p{font-family:inherit;font-weight:400;font-size:1em;line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #dddddf;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em;height:0}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{font-size:1em;line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0;font-size:1em}
ul.square li ul,ul.circle li ul,ul.disc li ul{list-style:inherit}
ul.square{list-style-type:square}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
abbr,acronym{text-transform:uppercase;font-size:90%;color:rgba(0,0,0,.8);border-bottom:1px dotted #ddd;cursor:help}
abbr{text-transform:none}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote cite{display:block;font-size:.9375em;color:rgba(0,0,0,.6)}
blockquote cite::before{content:"\2014 \0020"}
blockquote cite a,blockquote cite a:visited{color:rgba(0,0,0,.6)}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:solid 1px #dedede}
table thead,table tfoot{background:#f7f8f7}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt{background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{display:table-cell;line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.clearfix::before,.clearfix::after,.float-group::before,.float-group::after{content:" ";display:table}
.clearfix::after,.float-group::after{clear:both}
:not(pre):not([class^=L])>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background:#f7f7f8;-webkit-border-radius:4px;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed;word-wrap:break-word}
:not(pre)>code.nobreak{word-wrap:normal}
:not(pre)>code.nowrap{white-space:nowrap}
pre{color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;line-height:1.45;text-rendering:optimizeSpeed}
pre code,pre pre{color:inherit;font-size:inherit;line-height:inherit}
pre>code{display:block}
pre.nowrap,pre.nowrap pre{white-space:pre;word-wrap:normal}
em em{font-style:normal}
strong strong{font-weight:400}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background:#f7f7f7;border:1px solid #ccc;-webkit-border-radius:3px;border-radius:3px;-webkit-box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em white inset;box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em #fff inset;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menuref{color:#000}
.menuseq b:not(.caret),.menuref{font-weight:inherit}
.menuseq{word-spacing:-.02em}
.menuseq b.caret{font-size:1.25em;line-height:.8}
.menuseq i.caret{font-weight:bold;text-align:center;width:.45em}
b.button::before,b.button::after{position:relative;top:-1px;font-weight:400}
b.button::before{content:"[";padding:0 3px 0 2px}
b.button::after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin-left:auto;margin-right:auto;margin-top:0;margin-bottom:0;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header::before,#header::after,#content::before,#content::after,#footnotes::before,#footnotes::after,#footer::before,#footer::after{content:" ";display:table}
#header::after,#content::after,#footnotes::after,#footer::after{clear:both}
#content{margin-top:1.25em}
#content::before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #dddddf}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #dddddf;padding-bottom:8px}
#header .details{border-bottom:1px solid #dddddf;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:-ms-flexbox;display:-webkit-flex;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span::before{content:"\00a0\2013\00a0"}
#header .details br+span.author::before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark::before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber::after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #dddddf;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #e7e7e9;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #e7e7e9;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #e7e7e9;left:auto;right:0}}
@media screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:100%;background:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:rgba(255,255,255,.8);line-height:1.44}
#content{margin-bottom:.625em}
.sect1{padding-bottom:.625em}
@media screen and (min-width:768px){#content{margin-bottom:1.25em}
.sect1{padding-bottom:1.25em}}
.sect1:last-child{padding-bottom:0}
.sect1+.sect1{border-top:1px solid #e7e7e9}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor::before,h2>a.anchor::before,h3>a.anchor::before,#toctitle>a.anchor::before,.sidebarblock>.content>.title>a.anchor::before,h4>a.anchor::before,h5>a.anchor::before,h6>a.anchor::before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
details,.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
details>summary:first-of-type{cursor:pointer;display:list-item;outline:none;margin-bottom:.75em}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock.fit-content>caption.title{white-space:nowrap;width:0}
.paragraph.lead>p,#preamble>.sectionbody>[class="paragraph"]:first-of-type p{font-size:1.21875em;line-height:1.6;color:rgba(0,0,0,.85)}
table.tableblock #preamble>.sectionbody>[class="paragraph"]:first-of-type p{font-size:inherit}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #dddddf;color:rgba(0,0,0,.6)}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border-style:solid;border-width:1px;border-color:#e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;-webkit-border-radius:4px;border-radius:4px}
.exampleblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child{margin-bottom:0}
.sidebarblock{border-style:solid;border-width:1px;border-color:#dbdbd6;margin-bottom:1.25em;padding:1.25em;background:#f3f3f2;-webkit-border-radius:4px;border-radius:4px}
.sidebarblock>:first-child{margin-top:0}
.sidebarblock>:last-child{margin-bottom:0}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock>.content>pre{-webkit-border-radius:4px;border-radius:4px;word-wrap:break-word;overflow-x:auto;padding:1em;font-size:.8125em}
@media screen and (min-width:768px){.literalblock pre,.listingblock>.content>pre{font-size:.90625em}}
@media screen and (min-width:1280px){.literalblock pre,.listingblock>.content>pre{font-size:1em}}
.literalblock pre,.listingblock>.content>pre:not(.highlight),.listingblock>.content>pre[class="highlight"],.listingblock>.content>pre[class^="highlight "]{background:#f7f7f8}
.literalblock.output pre{color:#f7f7f8;background:rgba(0,0,0,.9)}
.listingblock>.content{position:relative}
.listingblock code[data-lang]::before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:inherit;opacity:.5}
.listingblock:hover code[data-lang]::before{display:block}
.listingblock.terminal pre .command::before{content:attr(data-prompt);padding-right:.5em;color:inherit;opacity:.5}
.listingblock.terminal pre .command:not([data-prompt])::before{content:"$"}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;-webkit-border-radius:4px;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.prettyprint{background:#f7f7f8}
pre.prettyprint .linenums{line-height:1.45;margin-left:2em}
pre.prettyprint li{background:none;list-style-type:inherit;padding-left:0}
pre.prettyprint li code[data-lang]::before{opacity:1}
pre.prettyprint li:not(:first-child) code[data-lang]::before{display:none}
table.linenotable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.linenotable td[class]{color:inherit;vertical-align:top;padding:0;line-height:inherit;white-space:normal}
table.linenotable td.code{padding-left:.75em}
table.linenotable td.linenos{border-right:1px solid currentColor;opacity:.35;padding-right:.5em}
pre.pygments .lineno{border-right:1px solid currentColor;opacity:.35;display:inline-block;margin-right:.75em}
pre.pygments .lineno::before{content:"";margin-right:-.125em}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock:not(.excerpt)>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote::before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.75em;margin-right:.5ex;text-align:right}
.verseblock{margin:0 1em 1.25em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract blockquote::before,.quoteblock.excerpt blockquote::before,.quoteblock .quoteblock blockquote::before{display:none}
.quoteblock.abstract blockquote,.quoteblock.abstract p,.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{line-height:1.6;word-spacing:0}
.quoteblock.abstract{margin:0 1em 1.25em;display:block}
.quoteblock.abstract>.title{margin:0 0 .375em;font-size:1.15em;text-align:center}
.quoteblock.excerpt>blockquote,.quoteblock .quoteblock{padding:0 0 .25em 1em;border-left:.25em solid #dddddf}
.quoteblock.excerpt,.quoteblock .quoteblock{margin-left:0}
.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{color:inherit;font-size:1.0625rem}
.quoteblock.excerpt .attribution,.quoteblock .quoteblock .attribution{color:inherit;text-align:left;margin-right:0}
table.tableblock{max-width:100%;border-collapse:separate}
p.tableblock:last-child{margin-bottom:0}
td.tableblock>.content>:last-child{margin-bottom:-1.25em}
td.tableblock>.content>:last-child.sidebarblock{margin-bottom:0}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all>thead>tr>.tableblock,table.grid-all>tbody>tr>.tableblock{border-width:0 1px 1px 0}
table.grid-all>tfoot>tr>.tableblock{border-width:1px 1px 0 0}
table.grid-cols>*>tr>.tableblock{border-width:0 1px 0 0}
table.grid-rows>thead>tr>.tableblock,table.grid-rows>tbody>tr>.tableblock{border-width:0 0 1px}
table.grid-rows>tfoot>tr>.tableblock{border-width:1px 0 0}
table.grid-all>*>tr>.tableblock:last-child,table.grid-cols>*>tr>.tableblock:last-child{border-right-width:0}
table.grid-all>tbody>tr:last-child>.tableblock,table.grid-all>thead:last-child>tr>.tableblock,table.grid-rows>tbody>tr:last-child>.tableblock,table.grid-rows>thead:last-child>tr>.tableblock{border-bottom-width:0}
table.frame-all{border-width:1px}
table.frame-sides{border-width:0 1px}
table.frame-topbot,table.frame-ends{border-width:1px 0}
table.stripes-all tr,table.stripes-odd tr:nth-of-type(odd),table.stripes-even tr:nth-of-type(even),table.stripes-hover tr:hover{background:#f8f8f7}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{display:table-cell;line-height:1.6;background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
ol>li p,ul>li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.checklist,ul.none,ol.none,ul.no-bullet,ol.no-bullet,ol.unnumbered,ul.unstyled,ol.unstyled{list-style-type:none}
ul.no-bullet,ol.no-bullet,ol.unnumbered{margin-left:.625em}
ul.unstyled,ol.unstyled{margin-left:0}
ul.checklist{margin-left:.625em}
ul.checklist li>p:first-child>.fa-square-o:first-child,ul.checklist li>p:first-child>.fa-check-square-o:first-child{width:1.25em;font-size:.8em;position:relative;bottom:.125em}
ul.checklist li>p:first-child>input[type="checkbox"]:first-child{margin-right:.25em}
ul.inline{display:-ms-flexbox;display:-webkit-box;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap;list-style:none;margin:0 0 .625em -1.25em}
ul.inline>li{margin-left:1.25em}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist td:not([class]):first-child{padding:.4em .75em 0;line-height:1;vertical-align:top}
.colist td:not([class]):first-child img{max-width:none}
.colist td:not([class]):last-child{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:solid 4px #fff;-webkit-box-shadow:0 0 0 1px #ddd;box-shadow:0 0 0 1px #ddd}
.imageblock.left{margin:.25em .625em 1.25em 0}
.imageblock.right{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em;border-width:1px 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none;margin-left:-1.05em}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
.gist .file-data>table{border:0;background:#fff;width:100%;margin-bottom:0}
.gist .file-data>table td.line-data{width:99%}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background:#00fafa}
.black{color:#000}
.black-background{background:#000}
.blue{color:#0000bf}
.blue-background{background:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background:#fa00fa}
.gray{color:#606060}
.gray-background{background:#7d7d7d}
.green{color:#006000}
.green-background{background:#007d00}
.lime{color:#00bf00}
.lime-background{background:#00fa00}
.maroon{color:#600000}
.maroon-background{background:#7d0000}
.navy{color:#000060}
.navy-background{background:#00007d}
.olive{color:#606000}
.olive-background{background:#7d7d00}
.purple{color:#600060}
.purple-background{background:#7d007d}
.red{color:#bf0000}
.red-background{background:#fa0000}
.silver{color:#909090}
.silver-background{background:#bcbcbc}
.teal{color:#006060}
.teal-background{background:#007d7d}
.white{color:#bfbfbf}
.white-background{background:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background:#fafa00}
span.icon>.fa{cursor:default}
a span.icon>.fa{cursor:inherit}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note::before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip::before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning::before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution::before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important::before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background:rgba(0,0,0,.8);-webkit-border-radius:100px;border-radius:100px;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]::after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,span.alt{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background:#fffef7;border-color:#e0e0dc;-webkit-box-shadow:0 1px 4px #e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@page{margin:1.25cm .75cm}
@media print{*{-webkit-box-shadow:none!important;box-shadow:none!important;text-shadow:none!important}
html{font-size:80%}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare)::after,a[href^="https:"]:not(.bare)::after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]::after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #dddddf!important;padding-bottom:0!important}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span::before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]::before{display:block}
#footer{padding:0 .9375em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
@media print,amzn-kf8{#header>h1:first-child{margin-top:1.25rem}
.sect1{padding:0!important}
.sect1+.sect1{border:0}
#footer{background:none}
#footer-text{color:rgba(0,0,0,.6);font-size:.9em}}
@media amzn-kf8{#header,#content,#footnotes,#footer{padding:0}}
</style>
</head>
<body class="article toc2 toc-left">
<div id="header">
<h1>XS2A Adapter</h1>
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#_1_introduction_and_goals">1. Introduction and Goals</a>
<ul class="sectlevel2">
<li><a href="#_1_1_requirements_overview">1.1. Requirements Overview</a></li>
<li><a href="#_1_2_quality_goals">1.2. Quality Goals</a></li>
<li><a href="#_1_3_stakeholders">1.3. Stakeholders</a></li>
</ul>
</li>
<li><a href="#_2_architecture_constraints">2. Architecture Constraints</a>
<ul class="sectlevel2">
<li><a href="#_2_1_technical_constraints">2.1. Technical Constraints</a></li>
<li><a href="#_2_2_organizational_constraints">2.2. Organizational Constraints</a></li>
<li><a href="#_2_3_conventions">2.3. Conventions</a></li>
</ul>
</li>
<li><a href="#_3_system_scope_and_context">3. System Scope and Context</a>
<ul class="sectlevel2">
<li><a href="#_3_1_business_context">3.1. Business Context</a></li>
<li><a href="#_3_2_technical_context">3.2. Technical Context</a></li>
</ul>
</li>
<li><a href="#_4_solution_strategy">4. Solution Strategy</a></li>
<li><a href="#_5_building_block_view">5. Building Block View</a>
<ul class="sectlevel2">
<li><a href="#_5_1_whitebox_xs2a_adapter_library">5.1. Whitebox XS2A Adapter Library</a>
<ul class="sectlevel3">
<li><a href="#_5_1_1_whitebox_xs2a_adapter_standalone">5.1.1. Whitebox XS2A Adapter Standalone</a></li>
<li><a href="#_5_1_2_aspsp_registry_blackbox">5.1.2. ASPSP Registry (Blackbox)</a></li>
<li><a href="#_5_1_3_service_loader_blackbox">5.1.3. Service-loader (Blackbox)</a></li>
<li><a href="#_5_1_4_bank_adapters_blackbox">5.1.4. Bank adapters (Blackbox)</a></li>
</ul>
</li>
<li><a href="#_5_2_building_blocks_level_2">5.2. Building Blocks - Level 2</a>
<ul class="sectlevel3">
<li><a href="#whitebox_aspsp_registry">5.2.1. Whitebox <em>ASPSP Registry</em></a></li>
<li><a href="#whitebox_service-loader">5.2.2. Whitebox <em>Service-loader</em></a></li>
<li><a href="#white_box_bank_adapters">5.2.3. Whitebox <em>Bank Adapters</em></a></li>
</ul>
</li>
<li><a href="#_5_3_level_3">5.3. Level 3</a>
<ul class="sectlevel3">
<li><a href="#account_information_service">5.3.1. Account Information Service (AIS) Interface (Blackbox).</a></li>
<li><a href="#payment_initiation_service">5.3.2. Payment Initiation Service (PIS) Interface (Blackbox).</a></li>
</ul>
</li>
<li><a href="#_non_xs2a_interfaces">Non-XS2A Interfaces.</a>
<ul class="sectlevel3">
<li><a href="#_oauth2_service">OAuth2 Service.</a></li>
<li><a href="#_embedded_pre_authorisation_service">Embedded Pre-Authorisation Service.</a></li>
</ul>
</li>
<li><a href="#_xs2a_adapter_specific_interfaces">XS2A Adapter Specific Interfaces.</a>
<ul class="sectlevel3">
<li><a href="#_aspsp_read_only_repository_service">ASPSP Read Only Repository Service.</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_6_runtime_view">6. Runtime View</a>
<ul class="sectlevel2">
<li><a href="#_6_1_send_request_to_aspsp">6.1. Send request to ASPSP</a></li>
<li><a href="#_6_2_sca_oauth2_approach">6.2 SCA OAuth2 Approach</a>
<ul class="sectlevel3">
<li><a href="#_6_2_1_integrated">6.2.1 Integrated</a></li>
<li><a href="#_6_2_2_pre_step">6.2.2 Pre-step</a></li>
<li><a href="#_6_2_3_oauth2_consent">6.2.3 OAuth2 Consent</a></li>
<li><a href="#_6_2_4_embedded_pre_step">6.2.4 Embedded Pre-step</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_7_deployment_view">7. Deployment View</a>
<ul class="sectlevel2">
<li><a href="#_7_1_xs2a_adapter_as_a_library">7.1. XS2A Adapter as a library</a></li>
<li><a href="#_7_2_xs2a_adapter_as_a_standalone_application">7.2. XS2A Adapter as a standalone application</a></li>
</ul>
</li>
<li><a href="#_8_cross_cutting_concepts">8. Cross-cutting Concepts.</a>
<ul class="sectlevel2">
<li><a href="#_8_1_xs2a_adapter_domain_model">8.1. XS2A Adapter Domain Model.</a>
<ul class="sectlevel3">
<li><a href="#_8_1_1_xs2a_requestresponse_flow_overview">8.1.1. XS2A Request/Response flow overview.</a></li>
<li><a href="#_8_1_2_xs2a_adapter_rest_interface">8.1.2. XS2A Adapter REST Interface.</a></li>
<li><a href="#_8_1_3_xs2a_adapter_aspsp_registry">8.1.3. XS2A Adapter ASPSP Registry.</a></li>
<li><a href="#_8_1_4_xs2a_adapter_service_loader">8.1.4. XS2A Adapter Service Loader.</a></li>
<li><a href="#_8_1_5_xs2a_adapter_service_implementation">8.1.5. XS2A Adapter Service Implementation.</a></li>
<li><a href="#_8_1_6_x_adapter">8.1.6. X-Adapter.</a></li>
</ul>
</li>
<li><a href="#_8_2_inheritance_of_the_base_services">8.2. Inheritance of the base services.</a></li>
<li><a href="#_8_3_http_client_and_requestresponse_interceptor">8.3. Http Client and Request/Response Interceptor.</a></li>
<li><a href="#_8_4_wiremock">8.4. WireMock.</a></li>
<li><a href="#_8_5_xs2a_adapter_exceptions">8.5. XS2A Adapter Exceptions.</a></li>
<li><a href="#_8_6_xs2a_adapter_configuration_properties">8.6. XS2A Adapter configuration properties.</a></li>
<li><a href="#_8_7_xs2a_adapter_pkcs12keystore">8.7. XS2A Adapter Pkcs12KeyStore.</a></li>
<li><a href="#_8_8_xs2a_adapter_request_signing">8.8. XS2A Adapter Request Signing.</a></li>
</ul>
</li>
<li><a href="#_9_design_decisions">9. Design Decisions.</a>
<ul class="sectlevel2">
<li><a href="#_9_1_wiremock">9.1. WireMock.</a></li>
<li><a href="#_9_2_apache_http_client">9.2. Apache HTTP Client.</a></li>
<li><a href="#_9_3_mapstruct">9.3. Mapstruct.</a></li>
<li><a href="#_9_4_javatar_commons">9.4. Javatar-commons.</a></li>
<li><a href="#_9_5_bouncy_castle">9.5. Bouncy Castle.</a></li>
<li><a href="#_9_6_nimbus_jose_jwt">9.6. Nimbus-jose-jwt.</a></li>
<li><a href="#_9_7_webjars_locator">9.7. Webjars-locator.</a></li>
<li><a href="#_9_8_postman">9.8. Postman.</a></li>
<li><a href="#_9_9_sonar">9.9. Sonar.</a></li>
<li><a href="#_9_10_swagger_ui">9.10. Swagger-UI.</a></li>
</ul>
</li>
<li><a href="#_10_quality_requirements">10. Quality Requirements.</a>
<ul class="sectlevel2">
<li><a href="#_10_1_quality_tree">10.1. Quality Tree.</a></li>
<li><a href="#_10_2_quality_scenarios">10.2. Quality Scenarios.</a></li>
</ul>
</li>
<li><a href="#_11_risks_and_technical_debts">11. Risks and Technical Debts.</a></li>
<li><a href="#_12_glossary">12. Glossary</a></li>
</ul>
</div>
</div>
<div id="content">
<div id="preamble">
<div class="sectionbody">
<!-- toc disabled -->
</div>
</div>
<div class="sect1">
<h2 id="_1_introduction_and_goals">1. Introduction and Goals</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The main idea of the XS2A Adapter project is to have one unified interface for PSD2 directive which based on the Berlin Group Specification that covers the vast majority of banks that implemented the Berlin Group Specification on their own.</p>
</div>
<div class="sect2">
<h3 id="_1_1_requirements_overview">1.1. Requirements Overview</h3>
<div class="paragraph">
<p>XS2A Adapter helps TPPs save time on connecting banks to their systems. XS2A Adapter suggests them to use one unified interface that fully compliant with Berlin Group Specification. All differences of implementation hidden inside a specified bank adapter.</p>
</div>
<div class="paragraph">
<p>Main features</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Connect plenty of banks</p>
</li>
<li>
<p>Organize contributors community from the world</p>
</li>
<li>
<p>Simplify the connection process of the bank that compliant with the Berlin Group Specification</p>
</li>
<li>
<p>Support Account Information and Payment initiation services</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_1_2_quality_goals">1.2. Quality Goals</h3>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 1. Quality Goals</caption>
<colgroup>
<col style="width: 0.99%;">
<col style="width: 24.7524%;">
<col style="width: 74.2576%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Nr.</th>
<th class="tableblock halign-left valign-top">Quality</th>
<th class="tableblock halign-left valign-top">Motivation</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Understandability</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The API should be clear enough for new clients to use XS2A Adapter, from the other hand the architecture should be not too complicated for contributors.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Interoperability</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The application should provide a unified API that allows access to all covered banks.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Testability</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The architecture should allow easy testing of all main building blocks.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="_1_3_stakeholders">1.3. Stakeholders</h3>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 2. Stakeholders</caption>
<colgroup>
<col style="width: 20%;">
<col style="width: 40%;">
<col style="width: 40%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">Role</th>
<th class="tableblock halign-left valign-top">Contact</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Denys Golubiev</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Software Architect PSD2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="mailto:dgo@adorsys.de">dgo@adorsys.de</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Francis Pouatcha</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Software Architect PSD2, Sales</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="mailto:fpo@adorsys.de">fpo@adorsys.de</a></p></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_2_architecture_constraints">2. Architecture Constraints</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The few constraints on this project are reflected in the final solution. This section shows them and if applicable, their motivation.</p>
</div>
<div class="sect2">
<h3 id="_2_1_technical_constraints">2.1. Technical Constraints</h3>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 3. List of Technical Constraints</caption>
<colgroup>
<col style="width: 5%;">
<col style="width: 30%;">
<col style="width: 65%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"></th>
<th class="tableblock halign-left valign-top">Constraint</th>
<th class="tableblock halign-left valign-top">Background and / or motivation</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-top" colspan="3"><p class="tableblock"><em>Software and programming constraints</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">TC1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Implementation in Java</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The application should support Java 8</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">TC2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Deployment</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The application should have a possibility to be used as a library and a standalone application at the same time</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">TC3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Distribution</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Library should be available as jar file on the maven central and as a docker image on the dockerHub</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="_2_2_organizational_constraints">2.2. Organizational Constraints</h3>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 4. List of Organizational Constraints</caption>
<colgroup>
<col style="width: 1%;">
<col style="width: 33%;">
<col style="width: 66%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"></th>
<th class="tableblock halign-left valign-top">Constraint</th>
<th class="tableblock halign-left valign-top">Background and / or motivation</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">OC1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Team</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Serhii Petrychenko, Snisarenko Artem, Oleksandr Berezkin</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">OC2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Time schedule</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Release planned each month</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">OC3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">IDE independent project setup</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No need to continue the editor and IDE wars. The project must be compilable on the command line via standard build tools.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">OC4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Configuration and version control</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Public git repository with a complete commit history and a public master branch pushed to GitHub.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">OC5</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Testing</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Use JUnit to prove functional correctness and integration tests and JaCoCo to ensure a high test coverage (at least 80%). Postman tests for covering end-to-end flows.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">OC6</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Published under an Open Source license</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The source, including documentation, should be published as Open Source under the Apache 2 License.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="_2_3_conventions">2.3. Conventions</h3>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 5. List of Conventions</caption>
<colgroup>
<col style="width: 1%;">
<col style="width: 33%;">
<col style="width: 66%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"></th>
<th class="tableblock halign-left valign-top">Conventions</th>
<th class="tableblock halign-left valign-top">Background and / or motivation</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">C1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Architecture documentation</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Structure based on the english arc42-Template in version 7.0</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">C2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Language</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">English. The project targets an international audience, so English should be used throughout the whole project.</p></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_3_system_scope_and_context">3. System Scope and Context</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This chapter describes the environment and context of <em>XS2A Adapter</em>: Who uses the system and on which other system does <em>XS2A Adapter</em> depend.</p>
</div>
<div class="sect2">
<h3 id="_3_1_business_context">3.1. Business Context</h3>
<div class="imageblock">
<div class="content">
<img src="./images/business-context.png" alt="3.1. business context" width="640">
</div>
</div>
<div class="paragraph">
<p>TPP</p>
</div>
<div class="paragraph">
<p>A <em>TPP</em> wants to make AIS and PIS requests to different banks via <em>XS2A Adapter</em>.</p>
</div>
<div class="paragraph">
<p>ASPSPs</p>
</div>
<div class="paragraph">
<p><em>XS2A Adapter</em> transforms request from <em>TPP</em> to a specific <em>ASPSP</em> request and sends it then transforms the response from <em>ASPSP</em> to a unified <em>XS2A Adapter</em> API response.</p>
</div>
</div>
<div class="sect2">
<h3 id="_3_2_technical_context">3.2. Technical Context</h3>
<div class="imageblock">
<div class="content">
<img src="./images/technical-context_1.png" alt="3.2.1. technical context" width="320">
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="./images/technical-context_2.png" alt="3.2.2. technical context" width="320">
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_4_solution_strategy">4. Solution Strategy</h2>
<div class="sectionbody">
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Implement XS2A Adapter in Java language with minimal external dependencies.</p>
</li>
<li>
<p>We use Maven automation build tool, so it can be used within automated builds</p>
</li>
<li>
<p>We have additional module that wraps XS2A Adapter into Spring Boot application and with the possibility to build a docker image</p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_5_building_block_view">5. Building Block View</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_5_1_whitebox_xs2a_adapter_library">5.1. Whitebox XS2A Adapter Library</h3>
<div class="imageblock">
<div class="content">
<img src="./images/whitebox_lv1_library.png" alt="5.1. Whitebox XS2A Adapter library" width="860">
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 6. Contained Building Blocks</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Building block</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">service-api</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Payment initiation, account information, http client and validation interfaces</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">service-impl</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Basic implementation of payment initiation and account information, implementation of http client</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">service-loader</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Load payment initiation or account information service implementation for specific adapter</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">aspsp-registry</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Registry of supported banks. Each record contains bank details and reference to the adapter</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">adapters</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Collection of bank adapters supported by XS2A Adapter</p></td>
</tr>
</tbody>
</table>
<div class="sect3">
<h4 id="_5_1_1_whitebox_xs2a_adapter_standalone">5.1.1. Whitebox XS2A Adapter Standalone</h4>
<div class="imageblock">
<div class="content">
<img src="./images/whitebox_lv1_stanalone.png" alt="5.1.1. Whitebox XS2A Adapter Standalone" width="620">
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 7. Contained Building Blocks</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Building block</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">service-api</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Payment initiation, account information, http client and validation interfaces</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">service-impl</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Basic implementation of payment initiation and account information, implementation of http client</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">service-loader</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Load payment initiation or account information service implementation for specific adapter</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">aspsp-registry</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Registry of supported banks. Each record contains bank details and reference to the adapter</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">adapters</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Collection of bank adapters supported by XS2A Adapter</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">rest-api</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ASPSP Registry REST API, OAuth REST API</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">rest2api-mapper</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Mappers between rest and service layers</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">generated-rest-api</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Generated REST API from Berlin Group yml specification</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">rest-impl</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Implementation of REST API</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_5_1_2_aspsp_registry_blackbox">5.1.2. ASPSP Registry (Blackbox)</h4>
<div class="paragraph">
<p><strong>Intent/Responsibility:</strong> ASPSP Registry provides API for searching supported banks. The list of supported banks stored in the CSV file.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 8. Interfaces</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Interface (From-To)</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">service-api &#8594; ASPSP search</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Search ASPSP in the registry</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Details are described in the <a href="#whitebox_aspsp_registry">Whitebox ASPSP Registry</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="_5_1_3_service_loader_blackbox">5.1.3. Service-loader (Blackbox)</h4>
<div class="paragraph">
<p><strong>Intent/Responsibility:</strong> Service-Loader looks up for specific service implementation of concrete bank adapter.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 9. Interfaces</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Interface (From-To)</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">service-loader &#8594; bank adapters</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Loads service implementations from supported bank adapters</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">rest-impl &#8594; service-loader</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Uses service-loader classes</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Details are described in the <a href="#whitebox_service-loader">Service-loader Whitebox</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="_5_1_4_bank_adapters_blackbox">5.1.4. Bank adapters (Blackbox)</h4>
<div class="paragraph">
<p><strong>Intent/Responsibility:</strong> Contains PIS &amp; AIS service implementations for supported banks</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 10. Interfaces</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Interface (From-To)</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">service-loader &#8594; bank adapters</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Loads service implementations from supported bank adapters</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">bank adapters &#8594; banks</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Makes HTTP requests to the banks</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Details are described in the <a href="#white_box_bank_adapters">Bank adapters Whitebox</a>.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_5_2_building_blocks_level_2">5.2. Building Blocks - Level 2</h3>
<div class="sect3">
<h4 id="whitebox_aspsp_registry">5.2.1. Whitebox <em>ASPSP Registry</em></h4>
<div class="imageblock">
<div class="content">
<img src="./images/whitebox_aspsp_registry.png" alt="5.2.1. Whitebox ASPSP Registry" width="520">
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 11. Contained Building Blocks</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Building Block</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Service</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Implementation of Search API. Contains methods for searching ASPSP by criteria</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Lucene</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The list of ASPSPs from CSV file loads into Lucene to speed up the search procedure</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="whitebox_service-loader">5.2.2. Whitebox <em>Service-loader</em></h4>
<div class="imageblock">
<div class="content">
<img src="./images/whitebox_service_loader.png" alt="5.2.2. Whitebox Service-loader" width="520">
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 12. Contained Building Blocks</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Building Block</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">AIS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Load implementation of AIS from requested ASPSP</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">PIS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Load implementation of PIS from requested ASPSP</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="white_box_bank_adapters">5.2.3. Whitebox <em>Bank Adapters</em></h4>
<div class="imageblock">
<div class="content">
<img src="./images/whitebox_bank_adapters.png" alt="5.2.3. Whitebox Bank Adapters" width="520">
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 13. Contained Building Blocks</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Building Block</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">AIS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">AIS implementation of exact ASPSP</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">PIS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">PIS implementation of exact ASPSP</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">HTTP client</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Uses for sending requests to the ASPSP</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_5_3_level_3">5.3. Level 3</h3>
<div class="sect3">
<h4 id="account_information_service">5.3.1. Account Information Service (AIS) Interface (Blackbox).</h4>
<div class="paragraph">
<p><strong>Intent/Responsibility:</strong> Performs request/response normalisation and calls a bank AIS endpoint.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 14. AIS Interface</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Method</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">createConsent</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">This method creates a consent resource, defining access rights to dedicated accounts of a given PSU-ID.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">getConsentInformation</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Returns the content of an account information consent object.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">deleteConsent</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The TPP can delete an account information consent object if needed.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">getConsentStatus</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Reads the status of an account information consent resource.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">getConsentAuthorisation</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Returns a list of all authorisation sub-resources IDs which have been created.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">startConsentAuthorisation</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Creates an authorisation sub-resource and start the authorisation process of a consent.
The message might in addition transmit authentication and authorisation related data.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">updateConsentsPsuData</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">This method updates PSU data on the consents resource if needed.
It may authorise a consent within the Embedded SCA Approach where needed.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">getAccountList</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Reads the identifiers of the available payment account together with booking balance information,
depending on the consent granted.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">readAccountDetails</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Reads details about an account, with balances where required.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">getTransactionList</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Reads transaction reports or transaction lists of a given account addressed by "account-id",
depending on the steering parameter "bookingStatus" together with balances.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">getTransactionDetails</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Reads transaction details from a given transaction addressed by "transactionId" on a given account addressed by "account-id".</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">getTransactionListAsString</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The same as <strong>getTransactionDetails</strong> but returns mere String object.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">getConsentScaStatus</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">This method returns the SCA status of a consent initiation&#8217;s authorisation sub-resource.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">getBalances</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Reads account data from a given account addressed by "account-id".</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">getCardAccountList</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Reads a list of card accounts with additional information, e.g. balance information.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">getCardAccountDetails</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Reads details about a card account.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">getCardAccountBalances</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Reads balance data from a given card account addressed by "account-id".</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">getCardAccountTransactionList</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Reads account data from a given card account addressed by "account-id".</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="payment_initiation_service">5.3.2. Payment Initiation Service (PIS) Interface (Blackbox).</h4>
<div class="paragraph">
<p><strong>Intent/Responsibility:</strong> Performs request/response normalisation and calls a bank PIS endpoint.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 15. PIS Interface</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Method</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">initiatePayment</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">This method is used to initiate a payment at the ASPSP.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">getSinglePaymentInformation</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Returns the content of a payment object of a single payment initiation request.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">getPeriodicPaymentInformation</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Returns the content of a payment object of a periodic payment initiation request.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">getPeriodicPain001PaymentInformation</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Returns the content of a payment object of an XML format periodic payment initiation request.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">getPaymentInformationAsString</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Returns the content of a payment object as a mere string.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">getPaymentInitiationScaStatus</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">This method returns the SCA status of a payment initiation&#8217;s authorisation sub-resource.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">getPaymentInitiationStatus</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Check the transaction status of a payment initiation.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">getPaymentInitiationStatusAsString</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The same as <strong>getPaymentInitiationStatus</strong> but returns mere String object.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">getPaymentInitiationAuthorisation</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Read a list of all authorisation subresources IDs which have been created.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">startPaymentAuthorisation</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Create an authorisation sub-resource and start the authorisation process.
The message might in addition transmit authentication and authorisation related data.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">updatePaymentPsuData</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">This methods updates PSU data on the authorisation resource if needed.
It may authorise a payment within the Embedded SCA Approach where needed.</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_non_xs2a_interfaces">Non-XS2A Interfaces.</h3>
<div class="paragraph">
<p>XS2A Adapter handles specific cases that are not specified or scarcely described in the PSD2 Berlin Group Specification.</p>
</div>
<div class="sect3">
<h4 id="_oauth2_service">OAuth2 Service.</h4>
<div class="paragraph">
<p><strong>Intent/Responsibility:</strong> This is API for supporting OAuth flow.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 16. OAuth2 Service Interface (with REST endpoints)</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Method</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">getAuthorizationRequestUri</p>
<p class="tableblock">GET <em>/oauth2/authorization-request-uri</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Retrieves an authorization URL from a bank IDP Server and supplies necessary parameters for
completing PSU authorization.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">getToken</p>
<p class="tableblock">POST <em>/oauth2/token</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Exchanges an authorization code for a bearer token.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_embedded_pre_authorisation_service">Embedded Pre-Authorisation Service.</h4>
<div class="paragraph">
<p><strong>Intent/Responsibility:</strong> This is API for supporting embedded pre-authorisation flow.</p>
</div>
<div class="paragraph">
<p>This is a Crealogix specific solution which is used by <strong>DKB</strong> bank.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 17. Embedded Pre-Authorisation Service Interface (with REST endpoints)</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Method</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">getToken</p>
<p class="tableblock">POST <em>/v1/embedded-pre-auth/token</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Exchanges user credentials for a bearer token.</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_xs2a_adapter_specific_interfaces">XS2A Adapter Specific Interfaces.</h3>
<div class="paragraph">
<p>For Adapter to address a request to a specific bank a bank adapter identifier is a must. To tackle the problem ASPSP Repository
was introduced. It traverses through the Lucene Repository that persists all available bank (ASPSP) records.</p>
</div>
<div class="sect3">
<h4 id="_aspsp_read_only_repository_service">ASPSP Read Only Repository Service.</h4>
<div class="paragraph">
<p><strong>Intent/Responsibility:</strong> Lookup for an appropriate adapter by incoming parameters.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 18. ASPSP Read Only Repository Interface (Library)</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Method</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">findById</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Retrieves an ASPSP by provided ID.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">findByBic</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Retrieves all ASPSPs by provided BIC.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">findByBankCode</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Retrieves all ASPSPs by provided BLZ (Bank Code).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">findByName</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Retrieves all ASPSPs by provided Bank Name.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">findAll</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Retrieves all ASPSPs from the Repository.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">findLike</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Retrieves all ASPSPs by provided set of data (e.g. BIC and Bank Name).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">findByIban</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Retrieves an ASPSP by provided IBAN.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The REST Client of the ASPSP Repository is also available, however its interface is simplified.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 19. ASPSP Repository REST Interface (Standalone)</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Method</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">GET <em>/v1/aspsp</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Finds all ASPSPs by one of the next parameters BIC, BLZ (bank code), IBAN or Bank Name or by a set of
listed parameters.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">GET <em>/v1/aspsp/{aspsp-id}</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Finds an ASPSP by ID.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Additional details on the ASPSP Repository can be found <a href="https://github.com/adorsys/xs2a-adapter/blob/develop/docs/aspsp_registry.md">here</a></p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_6_runtime_view">6. Runtime View</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_6_1_send_request_to_aspsp">6.1. Send request to ASPSP</h3>
<div class="paragraph">
<p>TPP sends request to ASPSP via XS2A Adapter.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./images/runtime-view.png" alt="Sequence diagram: Interaction with Adapter" width="960">
</div>
</div>
<div class="paragraph">
<p><strong>Scenario:</strong></p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>TPP makes call to ASPSP Registry to get the ID of supported bank adapter</p>
</li>
<li>
<p>ASPSP Registry returns the list of supported adapters. The result list is empty
when searched bank is unsupported.</p>
</li>
<li>
<p>TPP chooses and stores the ASPSP ID</p>
</li>
<li>
<p>TPP makes call to a bank via XS2A Adapter with ASPSP ID in the request headers</p>
</li>
<li>
<p>XS2A Core gets bank adapter details from ASPSP Registry</p>
</li>
<li>
<p>ASPSP Registry returns bank adapter details</p>
</li>
<li>
<p>XS2A Core sends initial TPP request to the specific bank adapter</p>
</li>
<li>
<p>ASPSP Adapter converts request regarding bank needs</p>
</li>
<li>
<p>ASPSP Adapter sends converted request to the bank</p>
</li>
<li>
<p>ASPSP Adapter receives response from the bank</p>
</li>
<li>
<p>ASPSP Adapter converts bank response to the XS2A Adapter model</p>
</li>
<li>
<p>ASPSP Adapter sends converts response to XS2A Core</p>
</li>
<li>
<p>XS2A Core replies with the converted response to TPP</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_6_2_sca_oauth2_approach">6.2 SCA OAuth2 Approach</h3>
<div class="imageblock">
<div class="content">
<img src="./images/oauth-sca.png" alt="OAuth2 SCA">
</div>
</div>
<div class="sect3">
<h4 id="_6_2_1_integrated">6.2.1 Integrated</h4>
<div class="imageblock">
<div class="content">
<img src="./images/oauth-integrated.png" alt="Integrated OAuth based authentication process in AIS context">
</div>
</div>
</div>
<div class="sect3">
<h4 id="_6_2_2_pre_step">6.2.2 Pre-step</h4>
<div class="imageblock">
<div class="content">
<img src="./images/oauth-pre-step.png" alt="OAuth based pre-step authentication process in AIS context">
</div>
</div>
</div>
<div class="sect3">
<h4 id="_6_2_3_oauth2_consent">6.2.3 OAuth2 Consent</h4>
<div class="imageblock">
<div class="content">
<img src="./images/oauth-consent.png" alt="OAuth based consent">
</div>
</div>
</div>
<div class="sect3">
<h4 id="_6_2_4_embedded_pre_step">6.2.4 Embedded Pre-step</h4>
<div class="imageblock">
<div class="content">
<img src="./images/embedded-pre-step.png" alt="Embedded Pre-step">
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_7_deployment_view">7. Deployment View</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_7_1_xs2a_adapter_as_a_library">7.1. XS2A Adapter as a library</h3>
<div class="imageblock">
<div class="content">
<img src="./images/deployment-view.png" alt="XS2A Adapter deployment (as a library)" width="100%">
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 20. Nodes description</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Node/Artifact</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">maven central repository</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Global public cloud repository. All XS2A Adapter libraries are uploaded there</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">xs2a-adapter deployment</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Deployment environment</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">release action</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">GitHub Action deploys artifacts to maven central and documentation to github pages</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">bank adapters</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Set of bank adapters that could be used by client</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="_7_2_xs2a_adapter_as_a_standalone_application">7.2. XS2A Adapter as a standalone application</h3>
<div class="imageblock">
<div class="content">
<img src="./images/deployment-view2.png" alt="XS2A Adapter deployment (as a standalone app)" width="520">
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 21. Nodes description</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Node/Artifact</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">xs2a-adapter deployment</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Container cluster management system</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">container registry</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Container registry e.g. DokerHub, GitLab, etc</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">radapter user computer</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">User builds and publishes docker image to the registry</p></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_8_cross_cutting_concepts">8. Cross-cutting Concepts.</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_8_1_xs2a_adapter_domain_model">8.1. XS2A Adapter Domain Model.</h3>
<div class="paragraph">
<p>The main goal of the XS2A Adapter is to normalize a request/response to/from a bank to be compliant to the Berlin Group PSD2 specification.</p>
</div>
<div class="sect3">
<h4 id="_8_1_1_xs2a_requestresponse_flow_overview">8.1.1. XS2A Request/Response flow overview.</h4>
<div class="paragraph">
<p>Request/response processing are mostly done in the specific adapter, but a request/response is passed through several layers until it reaches
an adapter.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./images/adapter-activity.png" alt="XS2A Adapter Activity" width="100%">
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 22. XS2A Adapter Activity</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Module</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">TPP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Third Party Payment Service Provider, a client of the XS2A Adapter.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Adapter REST Interface</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Receives requests and sends responses from/to a client, delegates a request to the ASPSP Registry
or to the Adapter Service Loader.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Adapter ASPSP Registry</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Retrieves an ASPSP information from a Lucene repository by a provided input.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Adapter Service Loader</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Loads an appropriate XS2A Adapter and delegates a request to it.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Adapters</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Collection of implemented bank adapters.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Adapter Service Implementation</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Module with base service implementations to deal with a request.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">X Adapter</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A specific XS2A Adapter that performs the request/response normalization and calls an appropriate bank.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ASPSP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Account Servicing Payment Service Provider or simply the Bank</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>There is no main Request or Response models in XS2A Adapter. Almost each operation has its own request/response structure,
these are models based on the Berlin Group specification. Full list and descriptions are available in the <a href="https://xs2a-adapter-integ.cloud.adorsys.de/swagger-ui.html">swagger file</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="_8_1_2_xs2a_adapter_rest_interface">8.1.2. XS2A Adapter REST Interface.</h4>
<div class="imageblock">
<div class="content">
<img src="./images/adapter-rest-interface.png" alt="XS2A Adapter REST Interface" width="100%">
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 23. XS2A Adapter REST Interface</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Class/Interface</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ConsentApi</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Operations for creating. deleting, reading and authorising a consent.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">AccountApi</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Operations for retrieving account data, like balances, transactions, transaction details, etc.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ConsentController</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Implements ConsentApi and AccountApi and delegates request processing to the Account Information Service.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Oauth2Api</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Operations for constructing Authorizing URL and obtaining an Access Token.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">OAuth2Controller</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Implements Oauth2Api and delegates a request to the OAuth2 Service.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">PaymentApi</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Operations for the payment initiation, authorisation, and reading a payment information.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">AspspSearchApi</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Operations for retrieving an ASPSP information.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">AspspSearchController</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Implements AspspSearchApi and delegates a request to the Aspsp Search Service.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">EmbeddedPreAuthorisationApi</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Operation for retrieving an Access Token.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">EmbeddedPreAuthorisationController</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Implements EmbeddedPreAuthorisationApi and delegates a request to the Pre-Authorisation Service.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The full description of the XS2A Adapter REST API can be found on the <a href="https://xs2a-adapter-integ.cloud.adorsys.de/swagger-ui.html">Swagger page</a>.</p>
</div>
<div class="paragraph">
<p><a href="https://www.berlin-group.org/nextgenpsd2-downloads">Berlin Group Specification</a> provides comprehensive documentation on the PSD2 XS2A Interface.</p>
</div>
</div>
<div class="sect3">
<h4 id="_8_1_3_xs2a_adapter_aspsp_registry">8.1.3. XS2A Adapter ASPSP Registry.</h4>
<div class="paragraph">
<p>Adapter ASPSP Registry is sufficiently described in <a href="#whitebox_aspsp_registry">Whitebox ASPSP Registry</a></p>
</div>
</div>
<div class="sect3">
<h4 id="_8_1_4_xs2a_adapter_service_loader">8.1.4. XS2A Adapter Service Loader.</h4>
<div class="paragraph">
<p>Adapter Service Loader responsibility is to provide an appropriate XS2A Adapter to deal with a request/response routine.
The structure is the next:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./images/adapter-service-loader.png" alt="XS2A Adapter Service Loader" width="100%">
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 24. XS2A Adapter Service Loader</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Class/Interface</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">AdapterServiceLoader</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The class resolves which particular adapter should be called.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">AccountInformationServiceImpl</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The class calls Service Loader to get a particular adapter then passes the request
to the specific Account Information service.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">PaymentInitiationServiceImpl</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The class calls Service Loader to get a particular adapter then passes the request
to the specific Payment Initiation service.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">AccountInformationService</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The interface determines operations for retrieving account information, consent creation,
PSU authentication and authorisation. Based on PSD2 Berlin Group specification.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">PaymentInitiationService</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The interface determines operations for payment initiation, PSU authentication and authorisation.
Based on PSD2 Berlin Group specification.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_8_1_5_xs2a_adapter_service_implementation">8.1.5. XS2A Adapter Service Implementation.</h4>
<div class="paragraph">
<p>All base service implementations are located in the Adapter Service Implementation module:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./images/adapter-service-impl.png" alt="XS2A Adapter Service Implementation" width="100%">
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 25. XS2A Adapter Service Implementation</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Class/Interface</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">BaseAccountInformationService</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The class provides the base request/response normalization for account information retrieval
and calls a real bank.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">RequestBuilderImpl</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The class encapsulates all request related data like body, headers, query parameters, etc.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">BasePaymentInitiationService</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The class provides the base request/response normalization for payment initiation and calls a real bank.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">AbstractAdapterServiceProvider</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The abstract class encapsulates common for all service providers operations.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">AccountInformationService</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The interface determines operations for retrieving account information, consent creation,
PSU authentication and authorisation. Based on PSD2 Berlin Group specification.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Builder</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The interface determines operations for assembling request data.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Request</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Marker interface, encapsulates Builder interface.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Response</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Wrapper for a bank response. Contains a body, headers and HTTP status code.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">PaymentInitiationService</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The interface determines the operations for payment initiation, PSU authentication and authorisation.
Based on PSD2 Berlin Group specification.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">AccountInformationServiceProvider</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The interface determines operations for account information service provider.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">PaymentInitiationServiceProvider</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The interface determines operations for payment initiation service provider.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">AdapterServiceProvider</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The interface determines common operations for any service provider.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The full list of the AIS operations is put down <a href="#account_information_service">here</a> and PIS operations are <a href="#payment_initiation_service">here</a></p>
</div>
</div>
<div class="sect3">
<h4 id="_8_1_6_x_adapter">8.1.6. X-Adapter.</h4>
<div class="paragraph">
<p>Normalization of a request/response takes place in a particular X-Adapter:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./images/x-adapter.png" alt="X-Adapter" width="100%">
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 26. X Adapter</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Class/Interface</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">XAdapterServiceProvider</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Child of a AbstractAdapterServiceProvider with a specific bank implementations.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">XAccountInformationService</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Child of a BaseAccountInformationService with a specific bank implementations.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">XPaymentInitiationService</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Child of a BasePaymentInitiationService with a specific bank implementations.</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_8_2_inheritance_of_the_base_services">8.2. Inheritance of the base services.</h3>
<div class="paragraph">
<p>Creating an adapter is achieved via extending base services: AIS, PIS, OAuth2, etc.</p>
</div>
<div class="paragraph">
<p>A concrete adapter is merely simple as all main operations are performed in the base Account Information and
Payment Initiation services. Also, not all adapters need to extend a base service to add a specific change, a bank can have
a perfectly valid BG interface, so a base service is enough for connecting to an ASPSP.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./images/account-information-service-tree.png" alt="AIS child tree">
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="./images/payment-initiation-service-tree.png" alt="PIS child tree">
</div>
</div>
<div class="paragraph">
<p>However, all adapters must extend AbstractAdapterServiceProvider that implements AccountInformationServiceProvider and
PaymentInitiationServiceProvider for proper Service Loader work.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./images/adapter-service-provider-tree.png" alt="Adapter Service Provider tree" width="960">
</div>
</div>
<div class="paragraph">
<p>There are additional constrains on an adapter which listed <a href="https://github.com/adorsys/xs2a-adapter/blob/develop/docs/Adapter.md">here</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_8_3_http_client_and_requestresponse_interceptor">8.3. Http Client and Request/Response Interceptor.</h3>
<div class="paragraph">
<p>XS2A Adapter provides its own HTTP Client implementations: ApacheHttpClient, WiremockHttpClient.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./images/adapter-http-client.png" alt="XS2A Adapter HTTP Client" width="100%">
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 27. XS2A Adapter HttpClient</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Class/Interface</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">HttpClient</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Interface provides the list of operations for a client.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ResponseHandler</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Functional Interface for operation of handling a bank response.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">AbstractHttpClient</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Abstract class provides base implementation or Get, Post, Put, and Delete operations.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ApacheHttpClient</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Main implementation of the HttpClient that uses the <a href="https://hc.apache.org/httpcomponents-client-5.1.x/">Apache Components</a> solution.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">WiremockHttpClient</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A client on top of the ApacheHttpClient, that palms off a recorded bank response instead of
communicating to a real bank.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>More details on WireMock will come below.</p>
</div>
<div class="paragraph">
<p>To be able to modify a specific aspect of a request an Interceptor interface was introduced. With an interceptor a client
can pre- or post-handle a call to a bank.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./images/adapter-interceptor.png" alt="XS2A Adapter Interceptor" width="100%">
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 28. XS2A Adapter Interceptor</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Class/Interface</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Interceptor</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Interface provides the list of operations with default postHandle() implementation.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">adorsys.AdorsysSigningHeadersInterceptor</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Signs a request to banks that use the Adorsys solutions.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">adorsys.OauthHeaderInterceptor</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Adds a specified OAuth header to a request to banks that uses the Adorsys solutions.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">consors.PsuIdHeaderInterceptor</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Clears PSU-ID header if it contains mere quotes (<strong>""</strong>) for Consors.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">deutschebank.PsuIdHeaderInterceptor</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Normalize PSU-ID header if necessary for a specific Deutsche Bank branches.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">deutschebank.PsuIdTypeHeaderInterceptor</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Adds a defined value of PSU-ID-Type header based on a specific Deutsche Bank branch.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">verlag.PsuIdTypeHeaderInterceptor</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Removes a PSU-ID-Type header if it contains an empty value for banks that use Verlag solutions.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ing.IngClientAuthentication</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Signs a request to ING</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">adapter.impl.http.RequestSigningInterceptor</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Base singing request interceptor.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">adapter.impl.http.wiremock.WiremockStubDifferenceDetectingInterceptor</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Detects differences between a performed request and
recorded wiremock stubs.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="_8_4_wiremock">8.4. WireMock.</h3>
<div class="paragraph">
<p>For convenient testing of a client solution XS2A Adapter introduced a WireMock mode. In this configuration the adapter
itself doesn&#8217;t communicate with a real bank but returns a request/response record (also called a stub).</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./images/adapter-wiremock-mode.png" alt="XS2A Flow in WireMock mode" width="100%">
</div>
<div class="title">Figure 1. XS2A Flow in WireMock mode</div>
</div>
<div class="paragraph">
<p>A comprehensive description about XS2A Adapter WireMock mode can be found <a href="https://adorsys.github.io/xs2a-adapter/wiremock-mode">here</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_8_5_xs2a_adapter_exceptions">8.5. XS2A Adapter Exceptions.</h3>
<div class="paragraph">
<p>XS2A Adapter developed its own set of exceptions that can occur in specific situations. All of them are subtypes of RuntimeException.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./images/adapter-exceptions.png" alt="XS2A Adapter Exceptions" width="100%">
</div>
<div class="title">Figure 2. XS2A Adapter Exceptions</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 29. XS2A Adapter Exceptions</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Exception</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">HTTP Status</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">AccessTokenException</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Will occur if obtaining an access token failed. Used in specific OAuth approaches like DKB Embedded Pre-Step.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">400..500*</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">AdapterNotFoundException</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Thrown if XS2A Adapter Service Loader failed to find an adapter.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">400</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">AspspRegistrationException</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Thrown if ASPSP registry services failed to complete an operation.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">400</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">AspspRegistrationNotFoundException</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Thrown if no adapter found in the Registry by provided parameters (IBAN, BIC, Bank Code, etc.)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">400</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">BadRequestException</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Thrown if malformed request received, used in specific cases like missing scope for OAuth or wrong body
of PSU Update Data operations.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">400</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ErrorResponseException</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Common wrapper for a bank exception, most bank errors are folded into this class.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">400..500*</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">HttpRequestSigningException</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Thrown if XS2A Adapter failed to sign a request.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">500</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">IbanException</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Thrown if ASPSP Registry failed to process an IBAN.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">400</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">NotAcceptableException</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Thrown if JSON Response Handler received not a JSON formatted data.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">406</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">OAuthException</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Thrown if bank returned 401 or 403 for consent creation operation. This exception is specific for Sparda and Adorsys adapters.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">403</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">PsuPasswordEncodingException</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Thrown if PsuPasswordEncryptionService failed to complete an operation.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">500</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">RequestValidationException</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Thrown if a request failed a validation.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">400</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">RequestAuthorizationValidationException</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A subtype of RequestValidationException, thrown if AUTHORIZATION header is missing.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">401</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">UncheckedSSLHandshakeException</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Thrown if SSL Handshake Error occurred while establishing connection with a bank server.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">500</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Xs2aAdapterException</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">General exception, thrown if no other suitable exception exists.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">500</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><em>* HTTP Status depends on the status from the bank response</em></p>
</div>
</div>
<div class="sect2">
<h3 id="_8_6_xs2a_adapter_configuration_properties">8.6. XS2A Adapter configuration properties.</h3>
<div class="paragraph">
<p>XS2A Adapter expects to have <code>adapter.config.properties</code> with configuration key-value pairs for some adapters.</p>
</div>
<div class="paragraph">
<p>Those properties are parsed by AdapterConfig service, which uses <code>java.util.Properties</code> under the hood.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./images/adapter-config.png" alt="XS2A Adapter configuration" width="100%">
</div>
<div class="title">Figure 3. AdapterConfig</div>
</div>
<div class="paragraph">
<p>AdapterConfig interface provides reading properties operations and loading a new properties file, mostly for test purposes.</p>
</div>
<div class="paragraph">
<p>Additional details on the XS2A Adapter properties are <a href="https://github.com/adorsys/xs2a-adapter/blob/develop/docs/configuration.md">here</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_8_7_xs2a_adapter_pkcs12keystore">8.7. XS2A Adapter Pkcs12KeyStore.</h3>
<div class="paragraph">
<p>In order to interact with the Banks' XS2A Interfaces, a user will need to have an eIDAS certificate. XS2A Adapter expects
a user to supply a valid PKCS #12 Key Store file (.p12) with a certificate as a JVM parameter (standalone)
or as a parameter in the Pkcs12KeyStore constructor (library).</p>
</div>
<div class="paragraph">
<p>Description of the KeyStore and how to create it is already put down in <a href="https://github.com/adorsys/xs2a-adapter/blob/develop/docs/keystore.md">here</a></p>
</div>
</div>
<div class="sect2">
<h3 id="_8_8_xs2a_adapter_request_signing">8.8. XS2A Adapter Request Signing.</h3>
<div class="paragraph">
<p>XS2A Adapter can sign the request for a user, if an adapter applied <code>RequestSigningInterceptor</code> and has a QSEAL
certificate in a key store. In some specific cases (like ING) an adapter will have its own signing service.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./images/adapter-signing.png" alt="XS2A Adapter Request Signing Infrastructure" width="100%">
</div>
<div class="title">Figure 4. XS2A Adapter Signing Infrastructure</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 30. XS2A Adapter Interceptor</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Class/Interface</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Interceptor</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Interface provides the list of operations with default postHandle() implementation.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">RequestSigningInterceptor</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Adds signing data to the headers and delegates signing to the service.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">RequestSigningService</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Provides Digest, Signature and TPP Signature Certificate values.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Digest</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Model for a Digest header.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">DigestBuilder</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Calculates digest.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Signature</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Model for a Signature header.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Builder</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Calculates signature.</p></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_9_design_decisions">9. Design Decisions.</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_9_1_wiremock">9.1. WireMock.</h3>
<div class="paragraph">
<div class="title">Motivation.</div>
<p>It can be nice to have an opportunity for testing an XS2A Adapter user solution without an actual interaction with a bank
sandbox or production environment.</p>
</div>
<div class="paragraph">
<div class="title">Decision.</div>
<p><em>WireMock</em> is a simulator for HTTP-based APIs for stubbing and mocking web services.</p>
</div>
</div>
<div class="sect2">
<h3 id="_9_2_apache_http_client">9.2. Apache HTTP Client.</h3>
<div class="paragraph">
<div class="title">Motivation.</div>
<p>XS2A Adapter must communicate with a bank via HTTP protocols, thus an efficient, up-to-date, and feature-rich HTTP
client with the most recent protocol standards and recommendations is needed.</p>
</div>
<div class="paragraph">
<div class="title">Decision.</div>
<p><em>Apache HTTP Client</em> is a robust, versatile java based library for building HTTP-aware client applications.</p>
</div>
</div>
<div class="sect2">
<h3 id="_9_3_mapstruct">9.3. Mapstruct.</h3>
<div class="paragraph">
<div class="title">Motivation.</div>
<p>XS2A Adapter sometimes must work with bank models that are not BG compliant, thereby a mapping to an appropriate analogue
should be performed, which is onerous and error-prone if implemented manually.</p>
</div>
<div class="paragraph">
<div class="title">Decision.</div>
<p><em>Mapstruct</em> is a code generator that greatly simplifies the implementation of mappings between java bean types based on
convention over configuration approach.</p>
</div>
</div>
<div class="sect2">
<h3 id="_9_4_javatar_commons">9.4. Javatar-commons.</h3>
<div class="paragraph">
<div class="title">Motivation.</div>
<p>Some XS2A models are big and complex and cumbersome to build programmatically for testing purposes. Would be nice to drop
model creating from the test and be able to deserialize it from JSON or YAML representation.</p>
</div>
<div class="paragraph">
<div class="title">Decision.</div>
<p><em>javatar-commons</em> - a convenient set of JSON and YAML reading and deserialization utils.</p>
</div>
</div>
<div class="sect2">
<h3 id="_9_5_bouncy_castle">9.5. Bouncy Castle.</h3>
<div class="paragraph">
<div class="title">Motivation.</div>
<p>XS2A Adapter must load a specific certificate for password encryption for Deutsche Bank, need a tool for obtaining a bank
certificate.</p>
</div>
<div class="paragraph">
<div class="title">Decision.</div>
<p><em>Bouncy Castle</em> is a collection of APIs used in cryptography, including deserializing a certificate from an input stream.</p>
</div>
</div>
<div class="sect2">
<h3 id="_9_6_nimbus_jose_jwt">9.6. Nimbus-jose-jwt.</h3>
<div class="paragraph">
<div class="title">Motivation.</div>
<p>In Deutsche Bank case, PSU password should be encrypted based on JWE <a href="https://datatracker.ietf.org/doc/html/rfc7516">RFC7516</a> specification.</p>
</div>
<div class="paragraph">
<div class="title">Decision.</div>
<p><em>nimbus-jose-jwt</em> is a popular and robust Java and Android library for JSON Web Token (JWT), standard signature (JWS),
amd encryption (JWE).</p>
</div>
</div>
<div class="sect2">
<h3 id="_9_7_webjars_locator">9.7. Webjars-locator.</h3>
<div class="paragraph">
<div class="title">Motivation.</div>
<p>It would be nice to have a possibility for avoiding onerous supporting of webjars resource versioning for Swagger-UI.</p>
</div>
<div class="paragraph">
<div class="title">Decision.</div>
<p><em>webjars-locator</em> - a library to automatically resolve the version of any Webjar assets.</p>
</div>
</div>
<div class="sect2">
<h3 id="_9_8_postman">9.8. Postman.</h3>
<div class="paragraph">
<div class="title">Motivation.</div>
<p>Provide a convenient way of testing XS2A Adapter REST interface. Also, it should be a CLI for testing the API in a pipeline.</p>
</div>
<div class="paragraph">
<div class="title">Decision.</div>
<p><em>Postman</em> is an API platform for building and using APIs. XS2A Adapter provides a ready to use postman
<a href="https://github.com/adorsys/xs2a-adapter/tree/develop/postman">collections</a> for testing API locally.</p>
</div>
</div>
<div class="sect2">
<h3 id="_9_9_sonar">9.9. Sonar.</h3>
<div class="paragraph">
<div class="title">Motivation.</div>
<p>Nice to have a system for monitoring code quality, decrease bug appearance and avoid code smells.</p>
</div>
<div class="paragraph">
<div class="title">Decision.</div>
<p><em>Sonar</em> - open-source platform for continuous inspection of code quality to detect bugs, code smells, and security vulnerabilities.</p>
</div>
</div>
<div class="sect2">
<h3 id="_9_10_swagger_ui">9.10. Swagger-UI.</h3>
<div class="paragraph">
<div class="title">Motivation.</div>
<p>XS2A Adapter REST API should be represented visually (online) in an accessible and understandable way, following OpenAPI
specification, based on available JSON file.</p>
</div>
<div class="paragraph">
<div class="title">Decision.</div>
<p><em>Swagger-UI</em> Swagger UI allows anyone to visualize and interact with the API’s resources without having any of
the implementation logic in place.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_10_quality_requirements">10. Quality Requirements.</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_10_1_quality_tree">10.1. Quality Tree.</h3>
<div class="imageblock">
<div class="content">
<img src="./images/quality-tree.png" alt="XS2A Adapter Activity" width="100%">
</div>
</div>
</div>
<div class="sect2">
<h3 id="_10_2_quality_scenarios">10.2. Quality Scenarios.</h3>
<div class="paragraph">
<div class="title">Understandability / Clear for users.</div>
<p>XS2A Adapter should be easy and low cost to deploy, set up, and launch in a user environment.</p>
</div>
<div class="paragraph">
<div class="title">Understandability / Clear for contributors.</div>
<p>A potential contributor should be provided with necessary documentation and manuals for extending, improving an old adapter,
or creating a new one.</p>
</div>
<div class="paragraph">
<div class="title">Interoperability / Open and completely understood interface.</div>
<p>XS2A Adapter API must be open to the public, clear in details and low time and cost for utilizing as a library or
a standalone application.</p>
</div>
<div class="paragraph">
<div class="title">Testability / Coverage</div>
<p>XS2A Adapter test coverage should be above 80%.</p>
</div>
<div class="paragraph">
<div class="title">Testability / Independent from a bank accessibility.</div>
<p>XS2A Adapter should provide a clear way to be tested (e.g. integration or system tests) as a part of a user solution
without actual communication with a bank, which can be achieved via using <a href="https://adorsys.github.io/xs2a-adapter/wiremock-mode">WireMock mode</a>.</p>
</div>
<div class="paragraph">
<div class="title">Error transparent / Exceptions from ASPSPs must be passed</div>
<p>Original errors and exceptions from an ASPSP should be passed to an end-user (TPP) or at least logged for later tackling.</p>
</div>
<div class="paragraph">
<div class="title">Validations clear / Adapter validation remarks should be clear</div>
<p>XS2A Adapter Validation Error must contain enough description for a user to determine and fix a cause.</p>
</div>
<div class="paragraph">
<div class="title">Data mask / Sensitive information must be concealed</div>
<p>Data that can be considered as a user sensitive must be masked via HttpLogSanitizer.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_11_risks_and_technical_debts">11. Risks and Technical Debts.</h2>
<div class="sectionbody">
<div class="paragraph">
<div class="title">Changes in bank APIs.</div>
<p>Unfortunately, there is no way to follow after bank API updates automatically to be up to the latest interface versions.
Some banks do email notifications though, but it&#8217;s still required a manual checking.</p>
</div>
<div class="paragraph">
<div class="title">Undocumented bugs.</div>
<p>Some bank XS2A implementations contain bugs (e.g. Unicredit mandatory Creditor Address field for payment initiation).
All caught bugs are addressed to banks for fixing, that takes time for implementing from an ASPSP side, meanwhile XS2A Adapter
amends the behavior if possible. We cannot guarantee that all glitches are covered but do everything possible to keep track of
those and implement intermediate fixes.</p>
</div>
<div class="paragraph">
<div class="title">Specific behavior.</div>
<p>Some banks have specific requirements that are not contradicting the BG specification but also not intuitive (Deutsche Bank
predefined mandatory PSU-ID-Type values). XS2A Adapter covers some of those edge cases but not all. For example, a user
will want to explicitly request a list of transactions in XML from Sparkasse and Fiducia banks as they are supporting responses
in that format only.</p>
</div>
<div class="paragraph">
<div class="title">Deviation behavior of production environment.</div>
<p>XS2A Adapter is tested against bank sandboxes. Those are expected to resemble a production environment and in most cases
they are. However, there are some cases where behavior is not matching. As usual XS2A Adapter covers such specific instances
as those are encountered (e.g. Verlag banks in the sandbox anticipate Access header to be <code>plain/text</code> only, in production -
they accept only <code>application/json</code>). There is a possibility that not all mismatches are covered and documented.</p>
</div>
<div class="paragraph">
<div class="title">Updating BG specification.</div>
<p>Berlin Group specification is evolving with time, even though the API is mostly constant, models can be volatile. XS2A Adapter
tends to be inline with the latest specification version and migrating to a newer Adapter release can potentially break a
user implementation. It&#8217;s advised checking Adapter release notes and Swagger before migrating.</p>
</div>
<div class="paragraph">
<div class="title">Maintenance activities.</div>
<p>Banks sometimes perform maintenance activities on their side, XS2A Adapter is not designed to cover such edge cases,
neither keep track of them, and will just pass a 5xx error from the ASPSP side. Some banks inform their users about
maintenance works by email.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_12_glossary">12. Glossary</h2>
<div class="sectionbody">
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 31. Glossary</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Term</th>
<th class="tableblock halign-left valign-top">Definition</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">XS2A</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>Access to Account</em>, a name of an interface, defined by <a href="https://www.berlin-group.org/">Berlin Group</a> to comply
banks to the requirements of PSD2.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">PSD2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://ec.europa.eu/info/law/payment-services-psd-2-directive-eu-2015-2366_en"><em>Payment Service Directive 2</em></a>,
a European law for payments services.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">TPP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>Third Party Payment Service Provider</em>, a system that acts on behalf of PSU on its data hold by ASPSP.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ASPSP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>Account Servicing Payment Service Provider</em>, a banking system that holds account data of PSU and performs
corresponding operations over it.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">AIS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>Account Information Service</em> is an online service which provides consolidated information on payment accounts held by
a payment service user with payment service providers.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">PIS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>Payment Initiation Service</em> is an online service which accesses a user’s payment account to initiate
the transfer of funds on their behalf with the user’s consent and authentication.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SCA</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>Strong Customer Authentication</em> is a requirement of the second Payment Services Directive (PSD2), which aims
to add extra layers of security to electronic payments.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">OAuth</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://oauth.net/"><em>Open Authorization</em></a> is an open standard for authorization. OAuth provides client applications
a 'secure delegated access' to server resources on behalf of a resource owner.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">API</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://en.wikipedia.org/wiki/API"><em>Application Programming Interface</em></a> is a set of programming code that enables
data transmission between one software product and another.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">IDE</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://en.wikipedia.org/wiki/Integrated_development_environment"><em>Integrated Development Environment</em></a> is
a software application that provides comprehensive facilities to computer programmers for software development.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">REST</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://www.codecademy.com/articles/what-is-rest"><em>Representational State Transfer</em></a>, is an architectural style
for providing standards between computer systems on the web, making it easier for systems to communicate with each other.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">HTTP/HTTPS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://en.wikipedia.org/wiki/Hypertext_Transfer_Protocol"><em>HyperText Transfer Protocol</em></a> is
the communications protocol used to connect to Web servers on the Internet or on a local network (intranet). HTTPS (HTTP Secure) is the encrypted version of HTTP.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">CSV</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://en.wikipedia.org/wiki/Comma-separated_values"><em>Comma-Separated Values</em></a> file is a delimited text file that uses
a comma to separate values.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">URL</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://en.wikipedia.org/wiki/URL"><em>Uniform Resource Locator</em></a>, colloquially termed a web address, is a reference to
a web resource that specifies its location on a computer network and a mechanism for retrieving it.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">YAML</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://en.wikipedia.org/wiki/YAML"><em>Yet Another Markup Language</em></a> is a human friendly data serialization standard
for all programming languages.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">IDP Server</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>Identity Provider Server</em> is a system entity that creates, maintains, and manages identity information for
principals and also provides authentication services to relying applications within a federation or distributed network.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">PSU</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>Payment Service User</em> means a natural or legal person, including the Client, making use of Payment Services
in the capacity of either Payer or Payee, or both.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">BIC</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>Bank Identifier Code</em> is the same as the bank&#8217;s SWIFT address.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">BLZ or Bank Code</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://en.wikipedia.org/wiki/Bank_code"><em>Bankleitzahl (DE) or Bank Code</em></a> is a code assigned by
a central bank, a bank supervisory body, or a Bankers Association in
a country to all its licensed member banks or financial institutions.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Bank Name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ASPSP or a bank legal name.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">IBAN</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://en.wikipedia.org/wiki/International_Bank_Account_Number"><em>International Bank Account Number</em></a> is an internationally agreed system of identifying bank accounts across
national borders to facilitate the communication and processing of cross border transactions with a reduced risk of transcription errors.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">BG</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Stands for <em>Berlin Group</em>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">QSEAL</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>Qualified Electronic Seal Certificate</em> is a qualified digital certificate under the  trust  services  defined  in  the  eIDAS  Regulation.</p></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2021-12-30 08:31:37 UTC
</div>
</div>
</body>
</html>